!function(a){"use strict";var i,t,o;function n(){}window.Fallsky_Single_post_Background_Video=function(e){return this.activeHandler=!1,this.handlers={nativeVideo:new i,youtube:new t,vimeo:new o},this.init(e)},Fallsky_Single_post_Background_Video.prototype={init:function(e){for(var i in this.handlers){var t=this.handlers[i];if("test"in t&&t.test(e)){this.activeHandler=t.initialize.call(t,e);break}}return!!this.activeHandler&&this.activeHandler}},n.prototype={deferred:!1,initialize:function(e){return this.html=e,this.deferred=a.Deferred(),this.$container=a("<div>",{class:"fallsky-media-wrapper hide"}).appendTo(a("body")),this.container=this.$container.get(0),this.ready(),this.events(),this.deferred.promise(),this},ready:function(){},setVideo:function(e){this.$container.append(a("<div>",{class:"close-button",text:"close"})).append(e)},test:function(){return!1},getDimensions:function(){var e=this.$container.width()||16,i=this.$container.height()||9,t=i/e,o=this.container.ratio||9/16;return t<o?{width:e,height:e*o}:{height:i,width:i/o}},resizeVideo:function(){var e=this.video,i=this.getDimensions();e.width=i.width,e.height=i.height},events:function(){var i=this;this.$container.on("click",".close-button",function(e){i.pause()})},play:function(){this.$container.addClass("fallsky-media-fullscreen-playing show").removeClass("hide"),this.resizeVideo(),a("body").css("overflow","hidden"),this.playVideo()},playVideo:function(){},pauseVideo:function(){},pause:function(){this.pauseVideo(),this.$container.removeClass("fallsky-media-fullscreen-playing show").addClass("hide"),a("body").css("overflow",""),a(".play-video-btn").removeClass("playing")}},n.extend=function(e){var i;function t(){return n.apply(this,arguments)}for(i in(t.prototype=Object.create(n.prototype)).constructor=t,e)t.prototype[i]=e[i];return t},i=n.extend({test:function(e){document.createElement("video"),a(e);var i=/<video.*>.*<\/video>/.exec(e);return!!i&&(this.video=i[0],!0)},ready:function(){var e=this,i=a(this.video).get(0);i.autoplay=!1,i.loop="loop",this.video=i,e.setVideo(i),a(e.video).on("loadedmetadata",function(){e.container.ratio=(this.videoHeight||9)/(this.videoWidth||16),e.deferred.resolve()}),a(window).on("resize",function(){e.container.ratio&&e.$container.hasClass("show")&&e.resizeVideo.call(e)})},playVideo:function(){this.video.play()},pauseVideo:function(){this.video.pause()}}),t=n.extend({regex:/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?'"]*).*/,test:function(e){return this.regex.exec(e)},ready:function(){var e=this;if("YT"in window)YT.ready(e.loadVideo.bind(e));else{var i=document.createElement("script");i.src="https://www.youtube.com/iframe_api",i.onload=function(){YT.ready(e.loadVideo.bind(e))},document.getElementsByTagName("head")[0].appendChild(i)}},loadVideo:function(){var t=this,o=a("<div>",{class:"youtube-video"}).get(0),n=this.html.match(this.regex)[1];a.getJSON("https://noembed.com/embed",{format:"json",url:"https://www.youtube.com/watch?v="+n},function(e){var i;t.container.ratio=(e.height||9)/(e.width||16),i=t.getDimensions.call(t),t.setVideo(o),t.player=new YT.Player(o,{videoId:n,width:i.width,height:i.height,events:{onReady:function(e){t.video=t.$container.find(".youtube-video").get(0),t.deferred.resolve()},onStateChange:function(e){YT.PlayerState.ENDED===e.data&&e.target.playVideo()}},playerVars:{autoplay:0,controls:1,disablekb:1,fs:0,iv_load_policy:3,loop:1,modestbranding:1,playsinline:1,rel:0,showinfo:0}}),a(window).on("resize",function(){t.container.ratio&&t.$container.hasClass("show")&&t.video&&t.resizeVideo.call(t)})})},playVideo:function(){this.player.playVideo()},pauseVideo:function(){this.player.pauseVideo()}}),o=n.extend({regex:/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)/,test:function(e){return this.regex.exec(e)},ready:function(){this.loadVideo()},loadVideo:function(){var i=this,e=this.html.match(this.regex)[3],t=a("<div>",{id:"vimeo-video-"+e}).get(0);if(Vimeo&&Vimeo.Player){var o={id:e,loop:!0};i.setVideo(t),i.player=new Vimeo.Player("vimeo-video-"+e,o),Promise.all([i.player.getVideoWidth(),i.player.getVideoHeight()]).then(function(e){i.container.ratio=e[1]/e[0],i.video=i.$container.find("iframe").get(0),i.deferred.resolve(),a(window).on("resize",function(){i.container.ratio&&i.$container.hasClass("show")&&i.resizeVideo.call(i)})})}},playVideo:function(){this.player.play()},pauseVideo:function(){this.player.pause()},resizeVideo:function(){var e=this.video,i=this.$container;e.width=i.width(),e.height=i.height()}})}(jQuery);