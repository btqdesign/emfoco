!function(e){"use strict";var i,t,o;function n(){}window.Fallsky_Single_post_Background_Video=function(e){return this.activeHandler=!1,this.handlers={nativeVideo:new i,youtube:new t,vimeo:new o},this.init(e)},Fallsky_Single_post_Background_Video.prototype={init:function(e){for(var i in this.handlers){var t=this.handlers[i];if("test"in t&&t.test(e)){this.activeHandler=t.initialize.call(t,e);break}}return!!this.activeHandler&&this.activeHandler}},n.prototype={deferred:!1,initialize:function(i){return this.html=i,this.deferred=e.Deferred(),this.$container=e("<div>",{class:"fallsky-media-wrapper hide"}).appendTo(e("body")),this.container=this.$container.get(0),this.ready(),this.events(),this.deferred.promise(),this},ready:function(){},setVideo:function(i){this.$container.append(e("<div>",{class:"close-button",text:"close"})).append(i)},test:function(){return!1},getDimensions:function(){var e=this.$container.width()||16,i=this.$container.height()||9,t=i/e,o=this.container.ratio||9/16;return o>t?{width:e,height:e*o}:{height:i,width:i/o}},resizeVideo:function(){var e=this.video,i=this.getDimensions();e.width=i.width,e.height=i.height},events:function(){var e=this;this.$container.on("click",".close-button",function(i){e.pause()})},play:function(){this.$container.addClass("fallsky-media-fullscreen-playing show").removeClass("hide"),this.resizeVideo(),e("body").css("overflow","hidden"),this.playVideo()},playVideo:function(){},pauseVideo:function(){},pause:function(){this.pauseVideo(),this.$container.removeClass("fallsky-media-fullscreen-playing show").addClass("hide"),e("body").css("overflow",""),e(".play-video-btn").removeClass("playing")}},n.extend=function(e){var i;function t(){return n.apply(this,arguments)}for(i in t.prototype=Object.create(n.prototype),t.prototype.constructor=t,e)t.prototype[i]=e[i];return t},i=n.extend({test:function(i){document.createElement("video"),e(i);var t=/<video.*>.*<\/video>/.exec(i);return!!t&&(this.video=t[0],!0)},ready:function(){var i=this,t=e(this.video).get(0);t.autoplay=!1,t.loop="loop",this.video=t,i.setVideo(t),e(i.video).on("loadedmetadata",function(){i.container.ratio=(this.videoHeight||9)/(this.videoWidth||16),i.deferred.resolve()}),e(window).on("resize",function(){i.container.ratio&&i.$container.hasClass("show")&&i.resizeVideo.call(i)})},playVideo:function(){this.video.play()},pauseVideo:function(){this.video.pause()}}),t=n.extend({regex:/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?'"]*).*/,test:function(e){return this.regex.exec(e)},ready:function(){var e=this;if("YT"in window)YT.ready(e.loadVideo.bind(e));else{var i=document.createElement("script");i.src="https://www.youtube.com/iframe_api",i.onload=function(){YT.ready(e.loadVideo.bind(e))},document.getElementsByTagName("head")[0].appendChild(i)}},loadVideo:function(){var i=this,t=e("<div>",{class:"youtube-video"}).get(0),o=this.html.match(this.regex)[1];e.getJSON("https://noembed.com/embed",{format:"json",url:"https://www.youtube.com/watch?v="+o},function(n){var a;i.container.ratio=(n.height||9)/(n.width||16),a=i.getDimensions.call(i),i.setVideo(t),i.player=new YT.Player(t,{videoId:o,width:a.width,height:a.height,events:{onReady:function(e){i.video=i.$container.find(".youtube-video").get(0),i.deferred.resolve()},onStateChange:function(e){YT.PlayerState.ENDED===e.data&&e.target.playVideo()}},playerVars:{autoplay:0,controls:1,disablekb:1,fs:0,iv_load_policy:3,loop:1,modestbranding:1,playsinline:1,rel:0,showinfo:0}}),e(window).on("resize",function(){i.container.ratio&&i.$container.hasClass("show")&&i.video&&i.resizeVideo.call(i)})})},playVideo:function(){this.player.playVideo()},pauseVideo:function(){this.player.pauseVideo()}}),o=n.extend({regex:/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)/,test:function(e){return this.regex.exec(e)},ready:function(){this.loadVideo()},loadVideo:function(){var i=this,t=this.html.match(this.regex)[3],o=e("<div>",{id:"vimeo-video-"+t}).get(0);if(Vimeo&&Vimeo.Player){var n={id:t,loop:!0};i.setVideo(o),i.player=new Vimeo.Player("vimeo-video-"+t,n),Promise.all([i.player.getVideoWidth(),i.player.getVideoHeight()]).then(function(t){i.container.ratio=t[1]/t[0],i.video=i.$container.find("iframe").get(0),i.deferred.resolve(),e(window).on("resize",function(){i.container.ratio&&i.$container.hasClass("show")&&i.resizeVideo.call(i)})})}},playVideo:function(){this.player.play()},pauseVideo:function(){this.player.pause()},resizeVideo:function(){var e=this.video,i=this.$container;e.width=i.width(),e.height=i.height()}})}(jQuery);